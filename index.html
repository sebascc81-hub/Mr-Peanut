<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos Mr. Peanut</title>
    <style>
        /* --- ESTILO VISUAL: KRAFT Y SELLO --- */
        body { 
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f0e6d2; /* Fondo Kraft */
            color: #2c2c2c; /* Color Tinta Negra */
        }

        .container { 
            background: #fffdf5; 
            padding: 25px; 
            border: 2px solid #2c2c2c; 
            box-shadow: 5px 5px 0px rgba(44, 44, 44, 0.1); 
        }

        /* Cabecera y Logo */
        .logo-area { text-align: center; margin-bottom: 25px; }
        
        .logo-img {
            width: 180px; 
            height: auto;
            display: block;
            margin: 0 auto 15px auto; 
            mix-blend-mode: multiply; 
        }

        h1 { 
            text-align: center; 
            text-transform: uppercase; 
            letter-spacing: 3px; 
            border-bottom: 3px solid #2c2c2c; 
            padding-bottom: 15px;
            margin: 0;
            font-size: 2em;
            font-weight: 900; 
        }
        
        .brand-tagline {
            font-size: 0.9em; 
            font-style: italic; 
            margin-top: 10px;
            font-weight: bold;
        }

        /* T√≠tulos de secci√≥n */
        .section-title { 
            background-color: #2c2c2c;
            color: #f0e6d2;
            padding: 8px 12px;
            margin-top: 30px; 
            margin-bottom: 15px; 
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
            display: inline-block;
            letter-spacing: 1px;
        }

        /* Formulario */
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 0.95em; }
        input, select { 
            width: 100%; 
            padding: 12px; 
            margin-top: 8px; 
            border: 2px solid #2c2c2c; 
            border-radius: 0; 
            box-sizing: border-box; 
            font-size: 16px; 
            background-color: #fffdf5;
            color: #2c2c2c;
            font-weight: bold;
        }
        input::placeholder { color: #999; font-weight: normal; }

        /* Botones */
        button { 
            width: 100%; 
            padding: 15px; 
            border: 3px solid #2c2c2c; 
            font-size: 16px; 
            cursor: pointer; 
            font-weight: 900; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            margin-top: 20px; 
            transition: 0.2s;
        }
        
        .btn-add { background-color: transparent; color: #2c2c2c; } 
        .btn-add:hover { background-color: #2c2c2c; color: #f0e6d2; }
        
        .btn-send { background-color: #2c2c2c; color: #f0e6d2; margin-top: 35px; font-size: 1.1em;}
        .btn-send:hover { opacity: 0.9; box-shadow: 3px 3px 0px rgba(44, 44, 44, 0.2); transform: translate(-2px, -2px);}
        .btn-send:disabled { background-color: #777; border-color: #777; cursor: not-allowed; box-shadow: none; transform: none;}

        /* Carrito */
        #cart-container { margin-top: 30px; border: 3px solid #2c2c2c; background: white; display: none; }
        table { width: 100%; border-collapse: collapse; }
        th { background-color: #2c2c2c; color: #f0e6d2; text-align: left; padding: 12px; font-size: 0.85em; text-transform: uppercase; border-bottom: 2px solid #2c2c2c; letter-spacing: 1px;}
        td { padding: 12px; border-bottom: 2px solid #eee; font-size: 0.95em; vertical-align: middle; font-weight: bold;}
        .total-row { font-weight: 900; background-color: #f0e6d2; color: #2c2c2c; border-top: 3px solid #2c2c2c; font-size: 1.1em; }
        .delete-btn { color: #c0392b; cursor: pointer; font-weight: 900; text-align: center; font-size: 1.3em;}

        /* Etiquetas */
        .tag { display: inline-block; padding: 4px 8px; color: white; font-size: 0.75em; margin-right: 8px; text-transform: uppercase; font-weight: 900; border: 2px solid #2c2c2c; box-shadow: 2px 2px 0px rgba(0,0,0,0.2); }
        .tag-blue { background-color: #2980b9; } 
        .tag-wine { background-color: #800020; } 
        .tag-green { background-color: #27ae60; } 
        .tag-default { background-color: #7f8c8d; }

        /* --- PIE DE P√ÅGINA INSTAGRAM --- */
        .footer-social {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px dashed #2c2c2c; /* L√≠nea de corte */
            text-align: center;
        }
        .social-title {
            font-weight: 900;
            text-transform: uppercase;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .social-desc {
            font-size: 0.9em;
            font-style: italic;
            margin-bottom: 20px;
            line-height: 1.4;
        }
        .btn-insta {
            display: inline-block;
            text-decoration: none;
            color: #2c2c2c;
            border: 2px solid #2c2c2c;
            padding: 12px 25px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: 0.3s;
        }
        .btn-insta:hover {
            background-color: #2c2c2c;
            color: #f0e6d2;
        }

    </style>
</head>
<body>

<div class="container">
    
    <div class="logo-area">
        <img src="logo.png" class="logo-img" alt="Logo Mr Peanut">
        <h1>Mr. Peanut</h1>
        <div class="brand-tagline">El snack que tu cuerpo reconoce y agradece.</div>
    </div>
    
    <div class="section-title">1. Tus Datos</div>
    <label>Nombre del Cliente / Negocio</label>
    <input type="text" id="cliente" placeholder="Ej: Tienda La Esquina">
    <label>Persona de Contacto</label>
    <input type="text" id="contacto" placeholder="Ej: Juan P√©rez">
    <label>Tel√©fono / WhatsApp</label>
    <input type="tel" id="telefono" placeholder="Ej: 300 123 4567">
    <label>Direcci√≥n de Entrega</label>
    <input type="text" id="direccion" placeholder="Direcci√≥n completa">

    <div class="section-title">2. Arma tu pedido</div>
    <label>Producto</label>
    <select id="producto">
        <option value="">Cargando men√∫...</option>
    </select>

    <div style="display: flex; gap: 15px;">
        <div style="flex: 1;">
            <label>Cantidad</label>
            <input type="number" id="cantidad" value="1" min="1">
        </div>
        <div style="flex: 1; display: flex; align-items: flex-end;">
            <div id="priceDisplay" style="font-weight: 900; margin-bottom: 15px; width: 100%; text-align: right; font-size: 1.4em;">$0</div>
        </div>
    </div>

    <button class="btn-add" onclick="agregarAlCarrito()">+ Agregar al Pedido</button>

    <div id="cart-container">
        <table>
            <thead>
                <tr>
                    <th>Producto</th>
                    <th style="text-align: center;">Cant.</th>
                    <th>Total</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="cart-body"></tbody>
            <tfoot>
                <tr class="total-row">
                    <td colspan="2">TOTAL:</td>
                    <td id="grand-total">$0</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <button class="btn-send" id="btnEnviar" onclick="enviarPedido()" disabled>FINALIZAR PEDIDO</button>

    <div class="footer-social">
        <div class="social-title">üì∏ √önete a nuestra comunidad</div>
        <div class="social-desc">
            Conoce nuestro proceso artesanal, descubre los beneficios del man√≠ y ent√©rate antes que nadie de los <strong>NUEVOS LANZAMIENTOS</strong>.
        </div>
        
        <a href="https://www.instagram.com/mrpeanut1_" target="_blank" class="btn-insta">
            S√≠guenos en Instagram
        </a>
    </div>

</div>

<script>
    // ----------------------------------------------------
    // CONEXI√ìN CON TU NUEVA URL (ACTUALIZADA)
    // ----------------------------------------------------
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzvKd3WVYuOTwHG3jbODPc69hn6tNNJwji4Rxgvc4W_n-1Mffwwta0VteyW_4W5vjFuzg/exec"; 

    let catalogoPrecios = {};
    let carrito = [];

    window.onload = function() {
        fetch(SCRIPT_URL)
        .then(response => response.json())
        .then(productos => {
            const select = document.getElementById('producto');
            select.innerHTML = '<option value="">Selecciona un producto...</option>';
            productos.forEach(p => {
                let option = document.createElement('option');
                option.value = p.nombre;
                option.text = `${p.nombre} - $${p.precio.toLocaleString()}`; 
                catalogoPrecios[p.nombre] = p.precio;
                select.add(option);
            });
        })
        .catch(error => { console.error('Error:', error); document.getElementById('producto').innerHTML = '<option>Error cargando men√∫</option>'; });
    };

    function actualizarPrecioUnitario() {
        const nombre = document.getElementById('producto').value;
        const cant = document.getElementById('cantidad').value;
        const precio = catalogoPrecios[nombre] || 0;
        document.getElementById('priceDisplay').innerText = `$${(precio * cant).toLocaleString()}`;
    }
    document.getElementById('producto').addEventListener('change', actualizarPrecioUnitario);
    document.getElementById('cantidad').addEventListener('input', actualizarPrecioUnitario);

    function agregarAlCarrito() {
        const nombre = document.getElementById('producto').value;
        const cantidad = parseInt(document.getElementById('cantidad').value);

        if (!nombre || cantidad < 1 || isNaN(cantidad)) {
            alert("Por favor selecciona un producto y una cantidad v√°lida.");
            return;
        }
        const precioUnit = catalogoPrecios[nombre];
        const precioTotal = precioUnit * cantidad;

        carrito.push({ producto: nombre, cantidad: cantidad, precioUnitario: precioUnit, precioTotal: precioTotal });
        actualizarTablaCarrito();
        
        document.getElementById('producto').value = "";
        document.getElementById('cantidad').value = 1;
        document.getElementById('priceDisplay').innerText = "$0";
    }

    function actualizarTablaCarrito() {
        const tbody = document.getElementById('cart-body');
        tbody.innerHTML = "";
        let granTotal = 0;

        carrito.forEach((item, index) => {
            granTotal += item.precioTotal;
            let badge = '<span class="tag tag-default">PRODUCTO</span>';
            let nombreLower = item.producto.toLowerCase();

            if(nombreLower.includes("salado")) { badge = '<span class="tag tag-blue">SALADO</span>'; } 
            else if(nombreLower.includes("dulce")) { badge = '<span class="tag tag-wine">DULCE</span>'; } 
            else if(nombreLower.includes("mix") || nombreLower.includes("mixto")) { badge = '<span class="tag tag-green">MIX</span>'; }

            let row = `<tr>
                <td>${badge} ${item.producto}</td>
                <td style="text-align: center;">${item.cantidad}</td>
                <td>$${item.precioTotal.toLocaleString()}</td>
                <td class="delete-btn" onclick="eliminarItem(${index})">√ó</td>
            </tr>`;
            tbody.innerHTML += row;
        });

        document.getElementById('grand-total').innerText = `$${granTotal.toLocaleString()}`;
        const container = document.getElementById('cart-container');
        const btnEnviar = document.getElementById('btnEnviar');
        
        if (carrito.length > 0) {
            container.style.display = "block";
            btnEnviar.disabled = false;
            btnEnviar.innerHTML = `CONFIRMAR PEDIDO <br> ($${granTotal.toLocaleString()})`;
        } else {
            container.style.display = "none";
            btnEnviar.disabled = true;
            btnEnviar.innerText = "FINALIZAR PEDIDO";
        }
    }

    function eliminarItem(index) {
        carrito.splice(index, 1);
        actualizarTablaCarrito();
    }

    function enviarPedido() {
        const cliente = document.getElementById('cliente').value.trim();
        const telefono = document.getElementById('telefono').value.trim();
        const direccion = document.getElementById('direccion').value.trim();
        const contacto = document.getElementById('contacto').value.trim();

        if (!cliente || !telefono || !direccion) {
            alert("‚ö†Ô∏è Faltan datos obligatorios:\nPor favor completa el Nombre, Tel√©fono y Direcci√≥n.");
            return;
        }

        const btn = document.getElementById('btnEnviar');
        const textoOriginal = btn.innerHTML;
        btn.innerText = "ENVIANDO PEDIDO...";
        btn.disabled = true;

        const ordenCompleta = { cliente: cliente, telefono: telefono, direccion: direccion, contacto: contacto, carrito: carrito };

        fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(ordenCompleta) })
        .then(response => response.json())
        .then(data => {
            if(data.result === "Exito"){
                alert("‚úÖ ¬°PEDIDO CONFIRMADO!\n\nGracias por elegir Mr. Peanut. El pedido ha sido enviado y recibir√°s confirmaci√≥n interna.");
                carrito = []; 
                actualizarTablaCarrito();
                document.getElementById('cliente').value = "";
                document.getElementById('telefono').value = "";
                document.getElementById('direccion').value = "";
                document.getElementById('contacto').value = "";
                window.scrollTo(0, 0); 
            } else { alert("‚ùå Error: " + data.error); }
            btn.innerHTML = textoOriginal;
            btn.disabled = false;
        })
        .catch(error => {
            console.error('Error:', error);
            alert("‚ùå Error de conexi√≥n. Intenta nuevamente.");
            btn.innerHTML = textoOriginal;
            btn.disabled = false;
        });
    }
</script>

</body>
</html>